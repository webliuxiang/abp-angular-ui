<div class="quick-chat__bar">
  <strong class="quick-chat__bar--title" (click)="toggleCollapsed()">
    52ABP Pro {{ l('Chat') }}
  </strong>


  <div nz-tooltip [nzTooltipTitle]="l('LinkChatHome')">
    <span class="iconfont icon-link" style="color: rgba(0, 0, 0, 0.25);" [routerLink]="[ '/app/other/chat' ]"
      routerLinkActive="active"></span>
  </div>
  &emsp; &emsp;
  <nz-badge [nzDot]="dot" nz-tooltip [nzTooltipTitle]="l('FriendsList')">
    <span class="iconfont icon-user" style="color: rgba(0, 0, 0, 0.25);" (click)="friendsOpen()"></span>
  </nz-badge>
  &emsp; &emsp;
  <i nz-icon nzType="close" class="quick-chat__bar--close" (click)="close()" nz-tooltip
    [nzTooltipTitle]="l('Close')"></i>
</div>




<div class="quick-chat__body" [ngClass]="{ 'quick-chat__collapsed': collapsed }">
  <div class="quick-chat__content">
    <div class="chat__scroll-container chat__message-container" Scrollbar #messageScrollbar="scrollbarComp">


      <ng-container *ngIf="selectedUser; else elseTemplate">
        <div *ngFor="let m of selectedUser.messages"
          class="chat__message chat__message-{{ m.side === 1 ? 'right':'left' }}">

          <div class="chat__message-avatar">
            <app-friend-profile-picture [cssClass]="'chat__user-avatar'"
              [profilePictureId]="selectedUser.friendProfilePictureId" [userId]="selectedUser.friendUserId"
              [tenantId]="selectedUser.friendTenantId"></app-friend-profile-picture>
            <div class="chat__message-time">{{ m.creationTime | date:'shortTime'  }}</div>
          </div>
          <div class="chat__message-msg">
            <strong class="chat__message-msg--name">{{ m.side === 1 ?  'You' : selectedUser.friendUserName  }}</strong>
            <div class="chat__message-msg--text">{{ m.message }}</div>
          </div>

        </div>
      </ng-container>
      <ng-template #elseTemplate>
        <div class="chat__message-msg" style="text-align:center">
          <strong class="chat__message-msg--text">
            {{ l('ChooseFriends') }}
          </strong>
        </div>
      </ng-template>

    </div>
  </div>
  <div class="quick-chat__reply">
    <textarea class="quick-chat__reply--ipt scrollbar" [(ngModel)]="chatMessage" (keydown.enter)="enterSend($event)"
      #chatMessageInput [placeholder]="l('TypeAMessageHere')"></textarea>
  </div>
</div>



<ng-template #sidebox>

  <!-- 好友列表 -->
  <div class="chat__scroll-container" style="overflow: auto;">

    <span *ngFor="let i of friends " class="chat__contact" (click)="choUser(i)" [ngClass]="{
        'chat__contact-active': i.active,
        'chat__contact-offline': !i.isOnline
      }">
      <app-friend-profile-picture [cssClass]="'chat__user-avatar'" [profilePictureId]="i.friendProfilePictureId"
        [userId]="i.friendUserId" [tenantId]="i.friendTenantId"></app-friend-profile-picture>

      <div class="flex-1 ml-md">
        <div class="text-truncate">{{ i.friendUserName }}</div>
        <div>
          <nz-badge *ngIf="i.isOnline" nzStatus="success" nzText="Online"></nz-badge>
          <nz-badge *ngIf="!i.isOnline" nzStatus="default" nzText="Offline"></nz-badge>
        </div>
      </div>
      <nz-badge *ngIf="i.unreadMessageCount > 0" [nzCount]="i.unreadMessageCount"
        [nzStyle]="{ backgroundColor: '#52c41a' }"></nz-badge>
    </span>


  </div>


</ng-template>


<nz-drawer [nzWidth]="250" nzWrapClassName="alain-pro__drawer" [(nzVisible)]="userVisible" [nzClosable]="false"
  [nzMaskClosable]="true" nzPlacement="right" (nzOnClose)="firendsClose()">
  <ng-template [ngTemplateOutlet]="sidebox"></ng-template>
</nz-drawer>
